name: Django CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.7'
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        # 直接安装所需的包，而不是从 requirements.txt 读取
        pip install Django==3.2.10 pymysql==1.0.2 mysqlclient==2.1.0
        pip install coverage==6.5.0 unittest-xml-reporting==3.2.0
        # 如果还有其他需要的包，可以继续添加在这里
    - name: Run migrations
      run: |
        cd MoviesRecommend
        python manage.py migrate
    - name: Collect static files
      run: |
        cd MoviesRecommend
        python manage.py collectstatic --noinput
